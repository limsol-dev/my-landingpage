---
description: 
globs: 
alwaysApply: false
---
# ğŸ”’ TypeScript Safety & Type Excellence

## ğŸ“‹ CONTEXT & CONSTRAINTS
Korean pension booking system requiring strict type safety for reservation data, pricing calculations, and user inputs.
**CRITICAL**: All types must prevent runtime errors in production Korean environment.

## âœ… MUST DO - Type Safety Imperatives

### 1. Domain Type Architecture (FOLLOW EXACTLY)
Reference [types/reservation.ts](mdc:types/reservation.ts) as the gold standard:

```typescript
// âœ… MANDATORY: Base types first, then composed types
export type ReservationBase = {
  checkIn: Date | undefined      // âœ… Explicit undefined for form states
  checkOut: Date | undefined
  adults: number
  children: number
  totalGuests: number
}

// âœ… CRITICAL: Composed types using intersection
export type ReservationInfo = ReservationBase & {
  bbq: BBQOption                 // Korean BBQ specific
  meal: MealOption              // Korean meal options
  transport: TransportOption    // Bus rental for Korean groups
  experience: ExperienceOption  // Farm experience
  extra: ExtraOption           // Laundry, etc.
}

// âœ… MANDATORY: Validation functions with explicit return types
export const validateReservation = (
  reservation: ReservationInfo
): string[] => {
  const errors: string[] = []
  
  // Korean-specific validations
  if (!reservation.checkIn) {
    errors.push('ì²´í¬ì¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.')
  }
  if (!reservation.checkOut) {
    errors.push('ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.')
  }
  
  return errors
}
```

### 2. API Response Types (NON-NEGOTIABLE)
```typescript
// âœ… CRITICAL: All API responses must be typed
interface APIResponse<T> {
  success: boolean
  data?: T
  error?: string
  message?: string        // Korean error messages
  code?: string          // Error codes for Korean localization
}

// âœ… MANDATORY: Specific response types
interface ReservationResponse extends APIResponse<ReservationInfo> {
  reservationId?: string
  paymentUrl?: string    // Korean payment gateway
}

// âœ… CRITICAL: Error handling with Korean messages
type KoreanErrorCode = 
  | 'INVALID_DATE'       // 'ë‚ ì§œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤'
  | 'FULLY_BOOKED'       // 'ì˜ˆì•½ì´ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤'
  | 'INVALID_PHONE'      // 'ì—°ë½ì²˜ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤'
  | 'PAYMENT_FAILED'     // 'ê²°ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'

interface ErrorResponse extends APIResponse<never> {
  code: KoreanErrorCode
  koreanMessage: string
}
```

### 3. Form Validation with Zod (ABSOLUTE REQUIREMENT)
```typescript
import { z } from 'zod'

// âœ… MANDATORY: Korean phone number schema
const koreanPhoneSchema = z
  .string()
  .regex(/^010-\d{4}-\d{4}$/, 'ì˜¬ë°”ë¥¸ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (010-0000-0000)')

// âœ… CRITICAL: Korean name validation
const koreanNameSchema = z
  .string()
  .min(2, 'ì´ë¦„ì€ 2ê¸€ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤')
  .max(10, 'ì´ë¦„ì€ 10ê¸€ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤')
  .regex(/^[ê°€-í£a-zA-Z\s]+$/, 'í•œê¸€ ë˜ëŠ” ì˜ë¬¸ë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤')

// âœ… MANDATORY: Reservation form schema
const reservationFormSchema = z.object({
  customerName: koreanNameSchema,
  customerPhone: koreanPhoneSchema,
  customerEmail: z.string().email('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”').optional(),
  checkIn: z.date({ required_error: 'ì²´í¬ì¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' }),
  checkOut: z.date({ required_error: 'ì²´í¬ì•„ì›ƒ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”' }),
  totalGuests: z.number().min(1, 'ìµœì†Œ 1ëª… ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤').max(20, 'ìµœëŒ€ 20ëª…ê¹Œì§€ ì˜ˆì•½ ê°€ëŠ¥í•©ë‹ˆë‹¤'),
  specialRequests: z.string().max(500, 'íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì€ 500ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”').optional()
}).refine(
  (data) => data.checkOut > data.checkIn,
  {
    message: 'ì²´í¬ì•„ì›ƒ ë‚ ì§œëŠ” ì²´í¬ì¸ ë‚ ì§œ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤',
    path: ['checkOut']
  }
)

// âœ… CRITICAL: Infer type from schema
type ReservationFormData = z.infer<typeof reservationFormSchema>
```

### 4. Utility Types Excellence (FOLLOW STRICTLY)
```typescript
// âœ… MANDATORY: Use built-in utility types
type PartialReservation = Partial<ReservationInfo>
type RequiredReservationFields = Pick<ReservationInfo, 'checkIn' | 'checkOut' | 'totalGuests'>
type OptionalReservationFields = Omit<ReservationInfo, 'checkIn' | 'checkOut'>

// âœ… CRITICAL: Korean-specific utility types
type KoreanFormField = {
  label: string          // Korean label
  placeholder: string    // Korean placeholder
  errorMessage?: string  // Korean error message
  required: boolean
}

// âœ… MANDATORY: Component prop types
type BookingFormProps = {
  initialData?: PartialReservation
  onSubmit: (data: ReservationFormData) => Promise<void>
  onCancel: () => void
  disabled?: boolean
  className?: string
}

// âœ… CRITICAL: Event handler types
type BookingEventHandlers = {
  onDateChange: (field: 'checkIn' | 'checkOut', date: Date | undefined) => void
  onGuestCountChange: (count: number) => void
  onPhoneChange: (phone: string) => void
}
```

### 5. Type Guards & Runtime Validation (ESSENTIAL)
```typescript
// âœ… MANDATORY: Type guards for API responses
function isValidReservationResponse(
  response: unknown
): response is APIResponse<ReservationInfo> {
  return (
    typeof response === 'object' &&
    response !== null &&
    'success' in response &&
    typeof (response as any).success === 'boolean'
  )
}

// âœ… CRITICAL: Korean date validation
function isValidKoreanDate(date: unknown): date is Date {
  if (!(date instanceof Date)) return false
  if (isNaN(date.getTime())) return false
  
  // Korean business rule: no past dates
  const today = new Date()
  today.setHours(0, 0, 0, 0)
  return date >= today
}

// âœ… MANDATORY: Use type guards in API calls
const handleReservationSubmit = async (data: ReservationFormData) => {
  try {
    const response = await fetch('/api/reservations/create', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
    
    const result = await response.json()
    
    if (!isValidReservationResponse(result)) {
      throw new Error('Invalid API response format')
    }
    
    if (!result.success) {
      throw new Error(result.error || 'ì˜ˆì•½ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤')
    }
    
    // Type-safe access to result.data
    console.log('ì˜ˆì•½ ì™„ë£Œ:', result.data?.checkIn)
  } catch (error) {
    console.error('ì˜ˆì•½ ì˜¤ë¥˜:', error)
  }
}
```

## âŒ NEVER DO - Type Safety Violations

### ğŸš« FORBIDDEN Type Patterns
```typescript
// âŒ NEVER: Use 'any' type
const handleData = (data: any) => {  // FORBIDDEN
  return data.whatever.property
}

// âŒ NEVER: Unchecked type assertions
const reservation = apiResponse as ReservationInfo  // DANGEROUS

// âŒ NEVER: Implicit return types for public APIs
const calculatePrice = (reservation) => {  // Missing return type
  return reservation.totalGuests * 50000
}

// âŒ NEVER: Object or Function types
const props: Object = { name: 'test' }      // Too generic
const callback: Function = () => {}         // Too generic

// âŒ NEVER: Ignore TypeScript errors
// @ts-ignore                               // FORBIDDEN without explanation
const result = dangerousOperation()

// âŒ NEVER: Mutate readonly types
interface ReadonlyReservation {
  readonly checkIn: Date
}
const reservation: ReadonlyReservation = { checkIn: new Date() }
reservation.checkIn = new Date()  // FORBIDDEN
```

### ğŸš« FORBIDDEN API Patterns
```typescript
// âŒ NEVER: Untyped API calls
const response = await fetch('/api/reservations')
const data = await response.json()  // Unknown type
console.log(data.whatever)         // Runtime error risk

// âŒ NEVER: Missing error handling
const reservation = await createReservation(data)  // No try/catch

// âŒ NEVER: Hardcoded Korean text in types
type ErrorMessage = 'ì˜ˆì•½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'  // Use constants or i18n
```

---

## ğŸ¯ TYPE SAFETY CHECKLIST
Before submitting any TypeScript code:
- [ ] All function parameters and return types are explicitly typed
- [ ] API responses use proper generic types
- [ ] Korean text validation uses Zod schemas
- [ ] Type guards are used for runtime validation
- [ ] No `any`, `Object`, or `Function` types
- [ ] Error handling includes Korean-specific error codes
- [ ] Form data uses inferred Zod types

**Reference Implementation:** [types/reservation.ts](mdc:types/reservation.ts) for all type definitions

